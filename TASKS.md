# 開発タスク管理

最終更新: 2025-12-02

---

## 🔴 最優先タスク（システムの安定性・UXに直結）

### 1. ログイン後の自動リダイレクト実装 ✅
- [x] `authStore.ts`のログイン関数を更新
- [x] `authStore.ts`の登録関数を更新
- [x] ログイン成功時に`/dashboard`へ自動遷移
- [x] 登録成功時に`/dashboard`へ自動遷移
- [x] 動作確認

**見積時間:** 10分
**優先度:** ⚡ 最高
**担当者:** Claude
**完了日:** 2025-11-17

---

### 2. エラーハンドリングとユーザーフィードバック ✅
- [x] react-hot-toastのインストール
- [x] ToasterコンポーネントをApp.tsxに追加
- [x] ログイン失敗時のエラー表示
- [x] 登録失敗時のエラー表示
- [x] ローディング中の視覚的フィードバック
- [x] 成功時の通知メッセージ

**見積時間:** 20分
**優先度:** 🛡️ 高
**担当者:** Claude
**完了日:** 2025-11-17

---

### 3. ブラウザでの動作確認と不具合修正 ✅
- [x] ホームページ(`/`)の表示確認
- [x] ログインページ(`/login`)の動作確認
- [x] 登録ページ(`/register`)の動作確認
- [x] ダッシュボード(`/dashboard`)の表示確認
- [x] コースページ(`/course/scratch-intro`)の動作確認
- [x] クリエイターズワールド(`/creations`)の表示確認
- [x] ログアウト機能の確認
- [x] レスポンシブデザインの確認（モバイル・タブレット）
- [x] ブラウザの戻る/進むボタンの動作確認
- [x] 発見したバグの修正

**見積時間:** 30分
**優先度:** 🐛 高
**担当者:** Claude
**完了日:** 2025-11-27

---

## 🟡 高優先タスク（機能の完成度を高める）

### 4. Supabase Authentication の実装 ✅
- [x] Supabase Consoleでプロジェクト作成
- [x] Authenticationを有効化（メール/パスワード）
- [x] Supabase Databaseにusersテーブルを作成
- [x] Supabase設定値を`.env.local`に追加
- [x] `supabaseService.ts`を作成
- [x] `authStore.ts`をSupabase認証に切り替え
- [x] ログイン・登録・ログアウトの動作確認
- [x] ユーザーデータのSupabase保存確認

**見積時間:** 1時間
**優先度:** 🔐 高
**担当者:** Claude
**完了日:** 2025-12-02
**備考:** FirebaseからSupabaseに変更

---

### 5. フォームバリデーション（react-hook-form + zod） ✅
- [x] react-hook-formのインストール
- [x] zodのインストール
- [x] ログインフォームのバリデーションスキーマ作成
- [x] 登録フォームのバリデーションスキーマ作成
- [x] LoginPageにreact-hook-formを適用
- [x] RegisterPageにreact-hook-formを適用
- [x] リアルタイムバリデーションの実装（onBlurモード）
- [x] エラーメッセージの表示改善（赤枠線＋エラーテキスト）

**見積時間:** 1時間
**優先度:** ✅ 高
**担当者:** Claude
**完了日:** 2025-12-02

---

### 6. アニメーション追加（Framer Motion） ✅
- [x] framer-motionのインストール
- [x] ページ遷移アニメーションの実装（PageTransition コンポーネント）
- [x] ボタンホバーエフェクトの追加（whileHover/whileTap）
- [x] バッジ獲得時のお祝いアニメーション（BadgeAnimation コンポーネント）
- [x] モーダル表示アニメーションの改善（Modal コンポーネント）
- [x] Cardコンポーネントのホバーアニメーション
- [x] HomePageのスタッガーアニメーション

**見積時間:** 1.5時間
**優先度:** ✨ 中
**担当者:** Claude
**完了日:** 2025-12-02

---

## 🟢 中優先タスク（将来の拡張性）

### 7. Supabase データモデルの設計と実装 ✅
- [x] ユーザーテーブルのスキーマ設計
- [x] 学習進捗テーブルのスキーマ設計（user_progress）
- [x] バッジテーブルのスキーマ設計（badge_templates, user_badges）
- [x] コース・レッスンテーブルのスキーマ設計
- [x] Supabase RLSポリシーの作成（全テーブル）
- [x] データ読み込み関数の実装
- [x] データ更新関数の実装（レッスン完了、XP更新、バッジ付与）
- [x] バッジ条件チェック機能の実装
- [x] サンプルデータの投入
- [ ] リアルタイム同期の実装（将来対応）
- [ ] オフライン対応の検討（将来対応）

**見積時間:** 2時間
**優先度:** 📊 中
**担当者:** Claude
**完了日:** 2025-12-02
**備考:** FirestoreからSupabaseに変更、5テーブル作成完了

---

### 8. PWA対応（オフライン機能） ✅
- [x] vite-plugin-pwaのインストール
- [x] PWA設定ファイルの作成（vite.config.ts）
- [x] Service Workerの設定（Workbox）
- [x] マニフェストファイルの自動生成設定
- [x] キャッシュ戦略の設定（静的ファイル、フォント、API）
- [ ] アイコンの準備（各サイズ）※TODO: デザイン作成が必要
- [x] PWA使用ガイド作成
- [x] robots.txt作成
- [ ] 本番環境でのインストールテスト

**見積時間:** 2時間
**優先度:** 📱 中
**担当者:** Claude
**完了日:** 2025-12-02
**備考:** アイコン画像以外は実装完了、動作確認は本番環境で実施推奨

---

### 9. テストの実装（Vitest + React Testing Library） ✅
- [x] Vitestのインストール
- [x] React Testing Libraryのインストール
- [x] テスト環境の設定
- [x] コンポーネントの単体テスト作成
- [x] 認証フローの統合テスト
- [x] カスタムフックのテスト
- [ ] CIへのテスト組み込み（将来対応）
- [x] カバレッジレポートの設定

**見積時間:** 3時間
**優先度:** 🧪 中
**担当者:** Claude
**完了日:** 2025-12-02
**備考:** CI連携以外は実装完了、テストガイド作成済み

---

## 🔵 低優先タスク（あれば良い）

### 10. 国際化（i18n）対応 ✅
- [x] react-i18nextのインストール
- [x] 言語ファイルの作成（日本語・英語）
- [x] Headerコンポーネントの翻訳対応
- [ ] 全コンポーネントの翻訳対応（段階的に実装）
- [x] 言語切り替えボタンの実装
- [x] ブラウザ言語の自動検出

**見積時間:** 2時間
**優先度:** 🌍 低
**担当者:** Claude
**完了日:** 2025-12-02
**備考:** 基盤実装完了、各ページの翻訳は段階的に追加可能

---

### 11. アクセシビリティ強化 ✅
- [x] axe-coreの導入（開発環境での自動チェック）
- [x] ARIAラベルの追加（全コンポーネント）
- [x] キーボードナビゲーションの改善（Tab、Escape、Enter対応）
- [x] スクリーンリーダー対応（セマンティックHTML、ライブリージョン）
- [x] フォーカス管理の最適化（フォーカスリング、フォーカストラップ）
- [x] コントラスト比の確認（WCAG 2.1 AA準拠）
- [x] スキップリンクの実装（キーボードナビゲーション）
- [x] アクセシビリティドキュメントの作成

**見積時間:** 2時間
**優先度:** ♿ 低
**担当者:** Claude
**完了日:** 2025-12-03
**備考:** WCAG 2.1 レベルAA基準に準拠

---

### 12. SEO最適化（スキップ）
- [x] 基本的なメタタグは実装済み（index.html）
- [x] robots.txtは作成済み（Task 8）
- [ ] react-helmetのインストール（オプション）
- [ ] OGP画像の作成（オプション）
- [ ] サイトマップの生成（オプション）

**見積時間:** 1時間
**優先度:** 🔍 低
**担当者:** -
**備考:** 基本的なSEO要素は実装済み。必要に応じて後から追加可能

---

## 🔴 新規タスク（管理者機能）

### 13. 管理者機能 - フェーズ1: 基盤構築 ✅
- [x] Supabaseにユーザーロール追加（student, admin, super_admin）
- [x] Row Level Security (RLS) ポリシーの設定
- [x] 監査ログテーブルの作成
- [x] authStoreに権限管理機能追加（isAdmin, isSuperAdmin）
- [x] AdminRouteコンポーネント（アクセス制限）
- [x] 管理画面レイアウト（サイドバー、ヘッダー）
- [x] 管理ダッシュボードページ
- [x] 管理画面ルーティング（/admin, /admin/courses, /admin/users, /admin/analytics）
- [x] ユーザーダッシュボードに管理画面ボタン追加
- [x] 管理者ガイドドキュメント作成

**見積時間:** 1.5時間
**実際の時間:** 1.5時間
**優先度:** ⚡ 高
**担当者:** Claude
**完了日:** 2025-12-03
**備考:** 管理者機能の基盤完成。次はフェーズ2（教材管理）

---

### 14. 管理者機能 - フェーズ2: 教材管理 ✅
- [x] Supabaseテーブル作成（courses, lessons, quizzes）
- [x] adminService.tsの作成（CRUD API）
- [x] コース管理画面
  - [x] コース一覧表示
  - [x] コース作成フォーム
  - [x] コース編集フォーム
  - [x] コース削除機能
  - [ ] ドラッグ&ドロップで順序変更（次のフェーズで実装）
  - [x] 公開/非公開切り替え
- [x] レッスン管理画面
  - [x] レッスン一覧表示
  - [x] レッスン作成・編集フォーム
  - [ ] リッチテキストエディタ統合（次のフェーズで実装）
  - [ ] プレビュー機能（次のフェーズで実装）
- [ ] クイズ管理（次のフェーズで実装）
  - [ ] クイズ作成フォーム
  - [ ] 複数の問題形式対応
  - [ ] 正解率統計表示

**見積時間:** 8時間
**実際の時間:** 約4時間（基本機能完成）
**優先度:** 🔵 中
**担当者:** Claude
**完了日:** 2025-12-04
**備考:** コース・レッスンのCRUD機能完成。クイズ管理とリッチエディタは次のフェーズへ

---

### 15. 管理者機能 - フェーズ3: ユーザー管理
- [ ] ユーザー一覧ページ
- [ ] ユーザー検索・フィルター機能
- [ ] ユーザー詳細ページ
- [ ] ロール変更機能（スーパー管理者のみ）
- [ ] アカウント停止/有効化機能
- [ ] ユーザー学習進捗の閲覧

**見積時間:** 4時間
**優先度:** 🟡 中低
**担当者:** -

---

### 16. 管理者機能 - フェーズ4: 分析・統計
- [ ] 統計ダッシュボード
- [ ] アクティブユーザー数の表示
- [ ] コース完了率の計算・表示
- [ ] 人気コースランキング
- [ ] クイズ正解率統計
- [ ] チャート表示（recharts導入）

**見積時間:** 3時間
**優先度:** 🟢 低
**担当者:** -

---

## 📊 進捗サマリー

### 完了済みタスク ✅
- CDN依存の解消（Tailwind CSS、React/Zustand）
- CDN依存の解消（React/Zustand）
- React Routerの導入
- ローカル開発環境のセットアップ
- ログイン後の自動リダイレクト実装
- エラーハンドリングとユーザーフィードバック
- ブラウザでの動作確認と不具合修正
- Supabase Authentication の実装（Firebaseから変更）
- フォームバリデーション（react-hook-form + zod）
- アニメーション追加（Framer Motion）
- Supabase データモデルの設計と実装
- PWA対応（アイコン以外）
- テストの実装（Vitest + React Testing Library）
- 国際化（i18n）対応（基盤実装）
- アクセシビリティ強化（WCAG 2.1 AA準拠）
- **管理者機能 - フェーズ1: 基盤構築**
- **管理者機能 - フェーズ2: 教材管理（コース・レッスンCRUD）**

### 現在進行中 🔄
- なし

### 次の推奨タスク 🎯
- **クイズ管理機能の実装**（フェーズ2の残り）
- **リッチテキストエディタの統合**（レッスンコンテンツ編集）
- **管理者機能 - フェーズ3: ユーザー管理**
- または実際のコンテンツ作成・充実

### ブロック中 🚫
- なし

---

## 🎯 推奨する実装順序

### フェーズ1: 即座に使えるMVP（約3時間）
1. ログイン後の自動リダイレクト実装 (10分)
2. エラーハンドリング (20分)
3. ブラウザでの動作確認 (30分)
4. フォームバリデーション (1時間)
5. Firebase実装 (1時間)

### フェーズ2: UX向上（約3.5時間）
1. アニメーション追加 (1.5時間)
2. Firestoreデータモデル設計 (2時間)

### フェーズ3: 本番準備（約6時間）
1. PWA対応 (2時間)
2. テスト実装 (3時間)
3. SEO最適化 (1時間)

---

## 📝 メモ・課題

- Supabase認証が実装済み（Firebase問題により変更）
- 子供向けのため、保護者の同意管理機能が将来必要
- 有料プラン機能は別タスクとして管理予定
- `firebaseService.ts`は残っているが使用していない（削除推奨）
- **管理者機能の基盤完成** - 教材管理機能の実装が次のステップ

---

## 🚀 管理者機能の使い方

### 初回セットアップ
1. `supabase/migrations/add_user_roles.sql` をSupabase SQL Editorで実行
2. SQLファイル内のメールアドレスを自分のものに変更してスーパー管理者として設定
3. アプリにログインし、ダッシュボード右上の「管理画面」ボタンからアクセス

### 管理画面URL
- `/admin` - 管理ダッシュボード
- `/admin/courses` - コース管理（準備中）
- `/admin/users` - ユーザー管理（準備中）
- `/admin/analytics` - 分析・統計（準備中）

詳細は `docs/ADMIN_GUIDE.md` を参照してください。

---

### 17. 新規レッスン追加機能の実装 🆕
**開始日:** 2025-12-09
**優先度:** 🔴 高

#### 現状分析
**✅ 既に実装済み:**
- AdminLessonFormPage（フォームコンポーネント）は新規作成とエディット両方に対応
- createLesson関数がadminServiceに実装済み
- AdminLessonsPageに「新規レッスン作成」ボタンが実装済み

**❌ 問題点:**
1. ルーティングの不整合
   - ボタンは `/admin/courses/:courseId/lessons/new` にナビゲート
   - しかし、App.tsxには `/admin/courses/:courseId/lessons/:lessonId/edit` しかない
   - `/new` ルートが存在しないため404エラーになる

2. 表示の問題
   - AdminLessonsPageの147-149行目で削除済みの`lesson.title_en`を参照している

#### 実装タスク

- [x] **タスク17-1: ルーティングの追加**（優先度: 🔴 高）
  - ファイル: `App.tsx`
  - 内容: 174行目付近に新規レッスン作成用のルートを追加
  ```typescript
  <Route path="/admin/courses/:courseId/lessons/new" element={
    <AdminRoute>
      <AdminLayout>
        <AdminLessonFormPage />
      </AdminLayout>
    </AdminRoute>
  } />
  ```
  - 理由: `/new` ルートがないと新規作成ボタンが404エラーになる
  - **完了日:** 2025-12-09

- [x] **タスク17-2: 削除済みフィールドの参照を削除**（優先度: 🟡 中）
  - ファイル: `pages/AdminLessonsPage.tsx`
  - 内容: 147-149行目を削除
  ```typescript
  {lesson.title_en && (
    <p className="text-sm text-gray-500">{lesson.title_en}</p>
  )}
  ```
  - 理由: `title_en`カラムはデータベースから削除済み。参照するとエラーになる可能性がある
  - **完了日:** 2025-12-09

- [x] **タスク17-3: 動作確認**（優先度: 🔴 高）
  - 新規レッスン作成ボタンのクリック
  - フォームの表示確認
  - レッスンの作成実行
  - 作成後のリダイレクト確認
  - **完了日:** 2025-12-09

#### 将来の改善案（低優先度）
- [ ] `order_index`を自動で最大値+1にする
- [ ] `id`を自動生成する（現在は手動入力）
- [ ] エラーハンドリングの強化（重複IDチェック）
- [ ] UX改善（作成中のローディング表示など）

**見積時間:** 15分
**実際の時間:** 10分
**優先度:** 🔴 高
**担当者:** Claude
**完了日:** 2025-12-09
**ステータス:** ✅ 完了

---

---

### 18. レベルシステムの実装 🆕
**開始日:** 2025-12-09
**優先度:** 🔴 最高

#### 概要
学習フローを3階層構造（コース → レベル → レッスン）に変更

**新しい学習フロー:**
```
コース選択 → レベル選択 → レベル内レッスン → レッスン学習
```

**ルール:**
- レベル1をクリアしないとレベル2に進めない
- レベル内のレッスンも順番に進める
- レベル内の全レッスン完了でレベルクリア
- レベルクリアでボーナスXP付与

#### フェーズ1: データベース準備
- [ ] **タスク18-1: levelsテーブル作成**
  - マイグレーションSQL作成
  - RLSポリシー設定
  - インデックス作成

- [ ] **タスク18-2: lessonsテーブルにlevel_id追加**
  - level_idカラム追加
  - 外部キー制約設定
  - 既存データを「レベル1」に移行

- [ ] **タスク18-3: user_level_progressテーブル作成**
  - レベル進捗管理用
  - RLSポリシー設定

- [ ] **タスク18-4: サンプルデータ投入**
  - 各コースにレベル1を作成
  - 既存レッスンをレベル1に紐付け

#### フェーズ2: 型定義とサービス
- [ ] **タスク18-5: 型定義追加**
  - `types/index.ts`にLevelインターフェース追加
  - UserLevelProgressインターフェース追加

- [ ] **タスク18-6: サービス関数実装**
  - `getLevelsByCourseId()`
  - `getLessonsByLevelId()`
  - `completeLesson()` - レベルクリア判定含む
  - `awardLevelBonusXP()`

#### フェーズ3: 管理画面
- [ ] **タスク18-7: レベル管理画面**
  - AdminLevelsPage作成
  - レベルCRUD機能
  - レベル順序変更

- [ ] **タスク18-8: レッスンとレベルの紐付け**
  - AdminLessonFormPageにレベル選択追加
  - レベルごとのレッスン一覧表示

#### フェーズ4: 学習フロー
- [ ] **タスク18-9: レベル選択画面**
  - CourseLevelsPage作成
  - レベルのロック/解放表示
  - 進捗率表示

- [ ] **タスク18-10: レベル内レッスン一覧**
  - LevelLessonsPage作成（CoursePageを改修）
  - レッスンのロック/解放制御
  - 順次解放ロジック

- [ ] **タスク18-11: レベルクリア演出**
  - LevelClearModal作成
  - ボーナスXP付与
  - お祝いアニメーション

#### フェーズ5: ルーティングとナビゲーション
- [ ] **タスク18-12: ルート追加**
  - `/course/:courseId/levels` - レベル選択
  - `/course/:courseId/levels/:levelId` - レベル内レッスン

- [ ] **タスク18-13: ナビゲーション修正**
  - DashboardPageからの遷移先変更
  - パンくずリストの実装

**見積時間:** 6時間
**優先度:** 🔴 最高
**担当者:** Claude
**ステータス:** 進行中

---

**次のアクション:**
- **優先度最高**: タスク18「レベルシステムの実装」
- **その後**: タスク14「管理者機能 - フェーズ2: 教材管理」の残りタスク
