# PWA（Progressive Web App）ガイド

最終更新: 2025-12-02

---

## 📱 PWAとは？

**つくるコード**は、PWA（Progressive Web App）に対応しています。
PWAを使うと、Webアプリをスマホやパソコンのホーム画面に追加して、まるでネイティブアプリのように使うことができます。

---

## 🎯 PWAのメリット

### 子供向け学習に最適

1. **簡単アクセス**
   - ホーム画面からワンタップで起動
   - ブラウザを開く手間が不要

2. **オフライン学習**
   - 一度アクセスしたページはオフラインでも表示
   - 移動中（電車・車）でも学習できる
   - ネット環境が悪い場所でも安心

3. **アプリのような体験**
   - フルスクリーン表示で集中できる
   - アドレスバーが非表示で広々
   - スムーズな操作感

4. **軽量・高速**
   - ネイティブアプリより軽い
   - ストレージを圧迫しない
   - 自動アップデート

---

## 📲 インストール方法

### iOSデバイス（iPhone/iPad）

1. Safariで https://tsukuru-code.example.com にアクセス
2. 下部の「共有」ボタン（□↑）をタップ
3. 「ホーム画面に追加」を選択
4. 「追加」をタップ

→ ホーム画面にアイコンが追加されます！

### Androidデバイス

1. Chrome で https://tsukuru-code.example.com にアクセス
2. 右上のメニュー（⋮）をタップ
3. 「ホーム画面に追加」または「アプリをインストール」を選択
4. 「追加」をタップ

→ ホーム画面にアイコンが追加されます！

### PCブラウザ（Chrome/Edge）

1. ブラウザで https://tsukuru-code.example.com にアクセス
2. アドレスバー右端の「インストール」アイコン（⊕）をクリック
3. 「インストール」をクリック

→ アプリが独立したウィンドウで起動します！

---

## 🔄 オフライン機能

### キャッシュされるもの

- ✅ HTML/CSS/JavaScriptファイル
- ✅ 画像・フォント
- ✅ 一度アクセスしたページ

### キャッシュされないもの

- ❌ Supabaseからのリアルタイムデータ
- ❌ 新しいレッスンコンテンツ
- ❌ ユーザーデータの更新

### オフライン時の動作

- **ログイン済みの場合**: 基本的なナビゲーションが可能
- **未ログインの場合**: ホームページのみ表示
- **学習進捗の保存**: オンラインに戻ったときに自動同期（将来実装予定）

---

## 🛠️ 開発者向け情報

### Service Worker

PWAは Service Worker を使用してキャッシュとオフライン機能を実現しています。

**設定ファイル**: `vite.config.ts`

**キャッシュ戦略**:
- **静的ファイル**: すべてキャッシュ
- **Google Fonts**: CacheFirst（1年間キャッシュ）
- **Supabase API**: NetworkFirst（1日間キャッシュ）

### Manifest.json

アプリの情報は自動生成されます。

**設定内容**:
- アプリ名: つくるコード - Tsukuru Code
- テーマカラー: `#f59e0b`（アンバー）
- 背景色: `#fffbeb`（アンバー50）
- 表示モード: standalone（フルスクリーン）

### 開発環境でのテスト

開発サーバー（localhost）でもPWA機能を有効化しています。

```bash
npm run dev
```

→ http://localhost:3001 でPWAとしてインストール可能

### 本番ビルド

```bash
npm run build
npm run preview
```

→ Service Worker が有効化され、オフライン動作をテストできます

---

## 🐛 トラブルシューティング

### インストールできない

**症状**: 「ホーム画面に追加」が表示されない

**原因と対処法**:
- HTTPSでアクセスしていない → HTTPSサイトでアクセス
- manifest.jsonが読み込めない → ブラウザのコンソールでエラー確認
- すでにインストール済み → アンインストールしてから再試行

### オフラインで動作しない

**症状**: ネットがないとページが表示されない

**原因と対処法**:
- Service Workerが登録されていない → 開発者ツールで確認
- キャッシュがクリアされた → 再度オンラインでアクセス
- 初回アクセス → 一度すべてのページを読み込む必要あり

### 更新が反映されない

**症状**: アプリを更新したのに古いバージョンが表示される

**原因と対処法**:
- キャッシュが残っている → ページをリロード（Ctrl+Shift+R）
- Service Workerが更新されていない → 開発者ツールで「Update on reload」を有効化

---

## 📊 PWA対応状況

### 実装済み ✅
- Service Worker 自動登録
- Manifest.json 自動生成
- 静的ファイルのキャッシュ
- オフライン フォールバック
- Google Fonts キャッシュ
- Supabase API キャッシュ

### 未実装（将来対応予定）
- アイコン画像（現在はプレースホルダー）
- プッシュ通知
- バックグラウンド同期
- 学習進捗のオフライン保存

---

## 🎨 アイコンについて

現在、PWAアイコンはプレースホルダーです。

**必要なアイコン**:
- `public/icon-192x192.png` - 192x192px
- `public/icon-512x512.png` - 512x512px
- `public/apple-touch-icon.png` - 180x180px（iOS用）
- `public/favicon.ico` - 32x32px（タブアイコン）

詳細は [public/ICONS_README.md](public/ICONS_README.md) を参照してください。

---

## 📚 参考リンク

- [PWA公式ドキュメント](https://web.dev/progressive-web-apps/)
- [Vite PWA Plugin](https://vite-pwa-org.netlify.app/)
- [Workbox（Service Worker ライブラリ）](https://developers.google.com/web/tools/workbox)

---

**更新履歴**
- 2025-12-02: 初版作成（PWA対応完了）
